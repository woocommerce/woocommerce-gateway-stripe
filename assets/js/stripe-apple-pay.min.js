Stripe.setPublishableKey(wc_stripe_apple_pay_params.key),jQuery(function(a){"use strict";var b={init:function(){Stripe.applePay.checkAvailability(function(c){c&&(a("#apple-pay-button").show(),b.generate_cart())}),a(document.body).on("click","#apple-pay-button",function(b){if(b.preventDefault(),a(".wc-stripe-apple-pay-error").remove(),"yes"===wc_stripe_apple_pay_params.is_cart_page&&"yes"===wc_stripe_apple_pay_params.needs_shipping&&!a('#shipping_method input[type="radio"]').is(":checked"))return a("#apple-pay-button").before('<p class="woocommerce-error wc-stripe-apple-pay-error">'+wc_stripe_apple_pay_params.needs_shipping_msg+"</p>"),void a(document.body).animate({scrollTop:a(".wc-stripe-apple-pay-error").offset().top},500);var c={countryCode:wc_stripe_apple_pay_params.country_code,currencyCode:wc_stripe_apple_pay_params.currency_code,total:{label:wc_stripe_apple_pay_params.label,amount:wc_stripe_apple_pay_params.total},lineItems:wc_stripe_apple_pay_params.line_items,requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:"yes"===wc_stripe_apple_pay_params.needs_shipping?["postalAddress","phone","email","name"]:["phone","email","name"]},d=Stripe.applePay.buildSession(c,function(b,c){var d={action:"wc_stripe_apple_pay",nonce:wc_stripe_apple_pay_params.stripe_apple_pay_nonce,result:b};a.post(wc_stripe_apple_pay_params.ajaxurl,d).done(function(b){"true"===b.success&&(c(ApplePaySession.STATUS_SUCCESS),window.location.href=b.redirect),"false"===b.success&&(c(ApplePaySession.STATUS_FAILURE),a("#apple-pay-button").before('<p class="woocommerce-error wc-stripe-apple-pay-error">'+b.msg+"</p>"),a(document.body).animate({scrollTop:a(".wc-stripe-apple-pay-error").offset().top},500))}).fail(function(a){c(ApplePaySession.STATUS_FAILURE)})},function(a){console.log(a.message)});d.begin()})},generate_cart:function(){var b={action:"wc_stripe_generate_apple_pay_cart",nonce:wc_stripe_apple_pay_params.stripe_apple_pay_cart_nonce};a.post(wc_stripe_apple_pay_params.ajaxurl,b,function(a){wc_stripe_apple_pay_params.total=a.total,wc_stripe_apple_pay_params.line_items=a.line_items})}};b.init(),a(document.body).on("updated_cart_totals",function(){b.init()}),a(document.body).on("updated_checkout",function(){b.init()})});