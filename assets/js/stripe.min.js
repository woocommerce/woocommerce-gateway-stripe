jQuery(function(i){"use strict";try{var o=Stripe(wc_stripe_params.key,{locale:wc_stripe_params.stripe_locale||"auto"})}catch(e){return void console.log(e)}var r,n,a,e=Object.keys(wc_stripe_params.elements_options).length?wc_stripe_params.elements_options:{},t=Object.keys(wc_stripe_params.sepa_elements_options).length?wc_stripe_params.sepa_elements_options:{},s=o.elements(e),c=s.create("iban",t),m={getAjaxURL:function(e){return wc_stripe_params.ajaxurl.toString().replace("%%endpoint%%","wc_stripe_"+e)},unmountElements:function(){"yes"===wc_stripe_params.inline_cc_form?r.unmount("#stripe-card-element"):(r.unmount("#stripe-card-element"),n.unmount("#stripe-exp-element"),a.unmount("#stripe-cvc-element"))},mountElements:function(){i("#stripe-card-element").length&&("yes"!==wc_stripe_params.inline_cc_form?(r.mount("#stripe-card-element"),n.mount("#stripe-exp-element"),a.mount("#stripe-cvc-element")):r.mount("#stripe-card-element"))},createElements:function(){var e={base:{iconColor:"#666EE8",color:"#31325F",fontSize:"15px","::placeholder":{color:"#CFD7E0"}}},t={focus:"focused",empty:"empty",invalid:"invalid"},e=wc_stripe_params.elements_styling||e,t=wc_stripe_params.elements_classes||t;"yes"===wc_stripe_params.inline_cc_form?(r=s.create("card",{style:e,hidePostalCode:!0})).addEventListener("change",function(e){m.onCCFormChange(),e.error&&i(document.body).trigger("stripeError",e)}):(r=s.create("cardNumber",{style:e,classes:t}),n=s.create("cardExpiry",{style:e,classes:t}),a=s.create("cardCvc",{style:e,classes:t}),r.addEventListener("change",function(e){m.onCCFormChange(),m.updateCardBrand(e.brand),e.error&&i(document.body).trigger("stripeError",e)}),n.addEventListener("change",function(e){m.onCCFormChange(),e.error&&i(document.body).trigger("stripeError",e)}),a.addEventListener("change",function(e){m.onCCFormChange(),e.error&&i(document.body).trigger("stripeError",e)})),"yes"===wc_stripe_params.is_checkout?i(document.body).on("updated_checkout",function(){i("#stripe-card-element").children().length||(r&&m.unmountElements(),m.mountElements(),i("#stripe-iban-element").length&&c.mount("#stripe-iban-element"))}):(i("form#add_payment_method").length||i("form#order_review").length)&&(m.mountElements(),i("#stripe-iban-element").length&&c.mount("#stripe-iban-element"))},updateCardBrand:function(e){var t={visa:"stripe-visa-brand",mastercard:"stripe-mastercard-brand",amex:"stripe-amex-brand",discover:"stripe-discover-brand",diners:"stripe-diners-brand",jcb:"stripe-jcb-brand",unknown:"stripe-credit-card-brand"},r=i(".stripe-card-brand"),e=e in t?t[e]:"stripe-credit-card-brand";i.each(t,function(e,t){r.removeClass(t)}),r.addClass(e)},init:function(){"yes"!==wc_stripe_params.is_change_payment_page&&"yes"!==wc_stripe_params.is_pay_for_order_page||i(document.body).trigger("wc-credit-card-form-init"),i("form.woocommerce-checkout").length&&(this.form=i("form.woocommerce-checkout")),i("form.woocommerce-checkout").on("checkout_place_order_stripe checkout_place_order_stripe_bancontact checkout_place_order_stripe_sofort checkout_place_order_stripe_giropay checkout_place_order_stripe_ideal checkout_place_order_stripe_alipay checkout_place_order_stripe_sepa checkout_place_order_stripe_boleto checkout_place_order_stripe_oxxo",this.onSubmit),i("form#order_review").length&&(this.form=i("form#order_review")),i("form#order_review, form#add_payment_method").on("submit",this.onSubmit),i("form#add_payment_method").length&&(this.form=i("form#add_payment_method")),i("form.woocommerce-checkout").on("change",this.reset),i(document).on("stripeError",this.onError).on("checkout_error",this.reset),c.on("change",this.onSepaError),(i("#early_renewal_modal_submit[data-payment-method]").length?i("#early_renewal_modal_submit[data-payment-method=stripe]"):i("#early_renewal_modal_submit")).on("click",this.onEarlyRenewalSubmit),m.createElements(),window.addEventListener("hashchange",m.onHashChange),m.maybeConfirmIntent(),i(document).on("change",".wc_payment_methods",function(){var o,e;i("#stripe_boleto_tax_id").length&&(o=function(e){return 12<=e.replace(/\D/g,"").length?"00.000.000/0000-00":"000.000.000-009999"},e={onKeyPress:function(e,t,r,n){r.mask(o.apply({},arguments),n)}},i("#stripe_boleto_tax_id").mask(o,e))})},isStripeChosen:function(){return i("#payment_method_stripe, #payment_method_stripe_bancontact, #payment_method_stripe_sofort, #payment_method_stripe_giropay, #payment_method_stripe_ideal, #payment_method_stripe_alipay, #payment_method_stripe_sepa, #payment_method_stripe_eps, #payment_method_stripe_multibanco, #payment_method_stripe_boleto, #payment_method_stripe_oxxo").is(":checked")||i("#payment_method_stripe").is(":checked")&&"new"===i('input[name="wc-stripe-payment-token"]:checked').val()||i("#payment_method_stripe_sepa").is(":checked")&&"new"===i('input[name="wc-stripe-payment-token"]:checked').val()},isStripeSaveCardChosen:function(){return i("#payment_method_stripe").is(":checked")&&i('input[name="wc-stripe-payment-token"]').is(":checked")&&"new"!==i('input[name="wc-stripe-payment-token"]:checked').val()||i("#payment_method_stripe_sepa").is(":checked")&&i('input[name="wc-stripe_sepa-payment-token"]').is(":checked")&&"new"!==i('input[name="wc-stripe_sepa-payment-token"]:checked').val()},isStripeCardChosen:function(){return i("#payment_method_stripe").is(":checked")},isBancontactChosen:function(){return i("#payment_method_stripe_bancontact").is(":checked")},isGiropayChosen:function(){return i("#payment_method_stripe_giropay").is(":checked")},isIdealChosen:function(){return i("#payment_method_stripe_ideal").is(":checked")},isSofortChosen:function(){return i("#payment_method_stripe_sofort").is(":checked")},isAlipayChosen:function(){return i("#payment_method_stripe_alipay").is(":checked")},isSepaChosen:function(){return i("#payment_method_stripe_sepa").is(":checked")},isP24Chosen:function(){return i("#payment_method_stripe_p24").is(":checked")},isEpsChosen:function(){return i("#payment_method_stripe_eps").is(":checked")},isMultibancoChosen:function(){return i("#payment_method_stripe_multibanco").is(":checked")},isBoletoChosen:function(){return i("#payment_method_stripe_boleto").is(":checked")},isOxxoChosen:function(){return i("#payment_method_stripe_oxxo").is(":checked")},hasPaymentMethod:function(){return 0<i("input.stripe-payment-method").length},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},block:function(){m.isMobile()||m.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){m.form&&m.form.unblock()},getSelectedPaymentElement:function(){return i('.payment_methods input[name="payment_method"]:checked')},getOwnerDetails:function(){var e=i("#billing_first_name").length?i("#billing_first_name").val():wc_stripe_params.billing_first_name,t=i("#billing_last_name").length?i("#billing_last_name").val():wc_stripe_params.billing_last_name,r={name:"",address:{},email:"",phone:""};return r.name=e,r.name=e&&t?e+" "+t:i("#stripe-payment-data").data("full-name"),r.email=i("#billing_email").val(),r.phone=i("#billing_phone").val(),(void 0===r.phone||r.phone.length<=0)&&delete r.phone,(void 0===r.email||r.email.length<=0)&&(i("#stripe-payment-data").data("email").length?r.email=i("#stripe-payment-data").data("email"):delete r.email),(void 0===r.name||r.name.length<=0)&&delete r.name,r.address.line1=i("#billing_address_1").val()||wc_stripe_params.billing_address_1,r.address.line2=i("#billing_address_2").val()||wc_stripe_params.billing_address_2,r.address.state=i("#billing_state").val()||wc_stripe_params.billing_state,r.address.city=i("#billing_city").val()||wc_stripe_params.billing_city,r.address.postal_code=i("#billing_postcode").val()||wc_stripe_params.billing_postcode,r.address.country=i("#billing_country").val()||wc_stripe_params.billing_country,{owner:r}},createPaymentMethod:function(){var e=m.getOwnerDetails()["owner"];return(m.isSepaChosen()?o.createPaymentMethod({type:"sepa_debit",sepa_debit:c,billing_details:e}):o.createPaymentMethod({type:"card",card:r,billing_details:e})).then(m.paymentMethodResponse)},paymentMethodResponse:function(e){e.error?i(document.body).trigger("stripeError",e):(m.reset(),m.form.append(i('<input type="hidden" />').addClass("stripe-payment-method").attr("name","stripe_payment_method").val(e.paymentMethod.id)),i("form#add_payment_method").length||i("#wc-stripe-change-payment-method").length?m.paymentMethodSetup(e):m.form.trigger("submit"))},paymentMethodSetup:function(t){var e={error:{type:"api_connection_error"}};i.post({url:m.getAjaxURL("create_setup_intent"),dataType:"json",data:{stripe_payment_method_id:t.paymentMethod.id,nonce:wc_stripe_params.add_card_nonce},error:function(){i(document.body).trigger("stripeError",e)}}).done(function(e){return"success"===e.status?(i("form#add_payment_method").length&&i(m.form).off("submit",m.form.onSubmit),void m.form.trigger("submit")):void("requires_action"===e.status?o.confirmCardSetup(e.client_secret,{payment_method:t.paymentMethod.id}).then(function(e){e.error?i(document.body).trigger("stripeError",e):(i("form#add_payment_method").length&&i(m.form).off("submit",m.form.onSubmit),m.form.trigger("submit"))}).catch(function(e){console.log(e),i(document.body).trigger("stripeError",{error:e})}):i(document.body).trigger("stripeError",e))})},onSubmit:function(){if(!m.isStripeChosen())return!0;if(m.isStripeSaveCardChosen()||m.hasPaymentMethod())return!0;if(m.isBancontactChosen()||m.isGiropayChosen()||m.isIdealChosen()||m.isAlipayChosen()||m.isSofortChosen()||m.isP24Chosen()||m.isEpsChosen()||m.isMultibancoChosen())return!0;if(m.block(),m.isBoletoChosen()){if(!i("#stripe_boleto_tax_id").val())return m.submitError(wc_stripe_params.cpf_cnpj_required_msg),m.unblock(),!1;m.handleBoleto()}else m.isOxxoChosen()?m.handleOxxo():m.createPaymentMethod();return!1},handleBoleto:function(){m.executeCheckout("boleto",function(t){o.confirmBoletoPayment(t.client_secret,t.confirm_payment_data).then(function(e){m.handleConfirmResponse(t,e)})})},executeCheckout:function(e,t){const r=m.form.serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{});"order_review"===m.form.attr("id")?(r._ajax_nonce=wc_stripe_params.updatePaymentIntentNonce,r.order_id=wc_stripe_params.orderId,i.ajax({url:m.getAjaxURL(e+"_update_payment_intent"),type:"POST",data:r,success:function(e){if("success"!==e.result)return m.submitError(e.messages),void m.unblock();t(e)}})):i.ajax({url:wc_stripe_params.checkout_url,type:"POST",data:r,success:function(e){if("success"!==e.result)return m.submitError(e.messages,!0),void m.unblock();t(e)}})},handleConfirmResponse:function(e,t){t.error?i(document.body).trigger("stripeError",t):-1===e.redirect.indexOf("https://")||-1===e.redirect.indexOf("http://")?window.location=e.redirect:window.location=decodeURI(e.redirect)},handleOxxo:function(){m.executeCheckout("oxxo",function(t){o.confirmOxxoPayment(t.client_secret,t.confirm_payment_data).then(function(e){m.handleConfirmResponse(t,e)})})},onCCFormChange:function(){m.reset()},reset:function(){i(".wc-stripe-error, .stripe-payment-method").remove()},onSepaError:function(e){var t=m.getSelectedPaymentElement().parents("li").eq(0).find(".stripe-payment-method-errors");e.error?(console.log(e.error.message),i(t).html('<ul class="woocommerce_error woocommerce-error wc-stripe-error"><li /></ul>'),i(t).find("li").text(e.error.message)):i(t).html("")},onError:function(e,t){var r=t.error.message,n=m.getSelectedPaymentElement().closest("li"),o=n.find(".woocommerce-SavedPaymentMethods-tokenInput");n=i("body").hasClass("woocommerce-stripe-prb-clicked")?(i("body").removeClass("woocommerce-stripe-prb-clicked"),i("div.woocommerce-notices-wrapper").first()):o.length?(o=o.filter(":checked")).closest(".woocommerce-SavedPaymentMethods-new").length?i("#wc-stripe-cc-form .stripe-payment-method-errors"):o.closest("li").find(".stripe-payment-method-errors"):n.find(".stripe-payment-method-errors"),m.isSepaChosen()&&"invalid_owner_name"===t.error.code&&wc_stripe_params.hasOwnProperty(t.error.code)?m.submitError(wc_stripe_params[t.error.code]):("email_invalid"===t.error.code?r=wc_stripe_params.email_invalid:"invalid_request_error"!==t.error.type&&"api_connection_error"!==t.error.type&&"api_error"!==t.error.type&&"authentication_error"!==t.error.type&&"rate_limit_error"!==t.error.type||(r=wc_stripe_params.invalid_request_error),wc_stripe_params.hasOwnProperty(t.error.code)&&(r=wc_stripe_params[t.error.code]),m.reset(),i(".woocommerce-NoticeGroup-checkout").remove(),console.log(t.error.message),i(n).html('<ul class="woocommerce_error woocommerce-error wc-stripe-error"><li /></ul>'),i(n).find("li").text(r),i(".wc-stripe-error").length&&i("html, body").animate({scrollTop:i(".wc-stripe-error").offset().top-200},200),m.unblock(),i.unblockUI())},submitError:function(e,t=!1){t||((t=i('<div><ul class="woocommerce-error"><li /></ul></div>')).find("li").text(e),e=t.html()),i(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),m.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),m.form.removeClass("processing").unblock(),m.form.find(".input-text, select, input:checkbox").trigger("blur");e="";i("#add_payment_method").length&&(e=i("#add_payment_method")),i("#order_review").length&&(e=i("#order_review")),(e=i("form.checkout").length?i("form.checkout"):e).length&&i("html, body").animate({scrollTop:e.offset().top-100},500),i(document.body).trigger("checkout_error"),m.unblock()},onHashChange:function(){var e,t,r=window.location.hash.match(/^#?confirm-(pi|si)-([^:]+):(.+)$/);!r||r.length<4||(e=r[1],t=r[2],r=decodeURIComponent(r[3]),window.location.hash="",m.openIntentModal(t,r,!1,"si"===e))},maybeConfirmIntent:function(){var e,t;i("#stripe-intent-id").length&&i("#stripe-intent-return").length&&(e=i("#stripe-intent-id").val(),t=i("#stripe-intent-return").val(),m.openIntentModal(e,t,!0,!1))},openIntentModal:function(e,t,r,n){o[n?"handleCardSetup":"handleCardPayment"](e).then(function(e){if(e.error)throw e.error;e=e[n?"setupIntent":"paymentIntent"];"requires_capture"!==e.status&&"succeeded"!==e.status||(window.location=t)}).catch(function(e){r?window.location=t:(i(document.body).trigger("stripeError",{error:e}),m.form&&m.form.removeClass("processing"),i.get(t+"&is_ajax"))})},onEarlyRenewalSubmit:function(e){return e.preventDefault(),i.ajax({url:i("#early_renewal_modal_submit").attr("href"),method:"get",success:function(e){e=JSON.parse(e);e.stripe_sca_required?m.openIntentModal(e.intent_secret,e.redirect_url,!0,!1):window.location=e.redirect_url}}),!1}};m.init()});
